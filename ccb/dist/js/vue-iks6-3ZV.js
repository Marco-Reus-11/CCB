var e=(e,a,l)=>new Promise((t,n)=>{var s=e=>{try{i(l.next(e))}catch(a){n(a)}},o=e=>{try{i(l.throw(e))}catch(a){n(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,o);i((l=l.apply(e,a)).next())});import{r as a,o as l,a as t,c as n,b as s,d as o,e as i,f as c,g as u,l as r,h as d,i as v,t as m,n as p,w as h,v as f,F as g,j as y,k,m as b,p as w,u as C,q as _,s as I,S as L,x as T,y as E,z as j,A as x,B as S,C as A,D as U}from"./vendor-BPh-ckoX.js";const B=(e,a)=>{const l=e.__vccOpts||e;for(const[t,n]of a)l[t]=n;return l},$={class:"sidebar"},M={class:"toolbar"},q={class:"privacy"},z=["src"],D=B({__name:"Sidebar",emits:["showchat","showcontacts","todetail"],setup(u,{emit:r}){const d=r,v=a("");function m(){d("todetail","打开AI小助手")}function p(){d("showchat","打开聊天")}function h(){d("showcontacts","打开联系人")}function f(){window.open("https://blog.csdn.net/lnvb596914531?spm=1000.2115.3001.5343","_blank")}function g(){window.open("https://github.com/Marco-Reus-11/Coffee-Chat-Bar","_blank")}function y(){localStorage.clear(),location.reload()}return l(()=>e(null,null,function*(){try{const e=localStorage.getItem("token"),a=yield t.get("http://localhost:3000/user/info",{headers:{authorization:`Bearer ${e}`}});v.value=a.data.ava}catch(e){}})),(e,a)=>{const l=i("font-awesome-icon");return c(),n("div",$,[s("div",{class:"logo"},[s("img",{src:"/images/logo.png",alt:"LOGO",title:"AI智能小助手",onClick:m})]),s("div",M,[s("ul",null,[s("li",null,[o(l,{icon:"comment",title:"聊天",onClick:p})]),s("li",null,[o(l,{icon:"users",title:"通讯录",onClick:h})]),s("li",null,[o(l,{icon:["fas","eye"],title:"朋友圈",onClick:f})]),s("li",null,[o(l,{icon:"star",title:"收藏夹",onClick:g})])])]),s("div",q,[s("div",{class:"avatar",onClick:y},[s("img",{src:v.value,alt:""},null,8,z)])])])}}},[["__scopeId","data-v-0bdbb78b"]]),N=u("chat",{state:()=>({currentChatUser:null,messageLists:{}}),actions:{switchChatUser(e){this.currentChatUser=e},addMessage(e,a){this.messageLists[e]||(this.messageLists[e]=[]),this.messageLists[e].push(a)},getMessage(e){return this.messageLists[e]}}}),V=r("http://localhost:3000"),F={class:"contacts"},H={key:0,class:"set"},O={class:"top"},P={class:"top_child"},R={class:"chatroom"},W={class:"middle"},K={class:"avatar"},G={class:"frame"},J=["src"],Q={class:"friendname"},X={class:"sta"},Y={class:"bottom"},Z={class:"chat-list"},ee=["onClick"],ae={class:"avatar-box"},le={class:"avatar-small"},te=["src"],ne={class:"detail"},se={class:"name"},oe={class:"info"},ie={class:"time"},ce=B({__name:"LastChats",emits:["hidechat","changecolor","todetail"],setup(u,{emit:r}){const k=a("available"),b=a(!1),w=a([]),C=a(""),_=a(""),I=a(""),L=a(""),T=N(),E=r;function j(){E("hidechat","关掉聊天")}function x(){b.value=!0}function S(){E("changecolor",{color:"beige"}),b.value=!1}function A(){E("changecolor",{color:"mist"}),b.value=!1}function U(){E("changecolor",{color:"apricot"}),b.value=!1}function B(e){const a=new Date(e),l=new Date;return a.toLocaleDateString()===l.toLocaleDateString()?isNaN(a.getTime())?"":a.toLocaleTimeString().slice(0,5):isNaN(a.getTime())?"":a.toLocaleDateString().slice(0,10)}return l(()=>e(null,null,function*(){try{const e=localStorage.getItem("token"),a=yield t.get("http://localhost:3000/user/info",{headers:{authorization:`Bearer ${e}`}});I.value=a.data.name,_.value=a.data.id,L.value=a.data.ava,V.emit("login",a.data.id)}catch(e){}})),l(()=>e(null,null,function*(){try{const e=localStorage.getItem("token"),a=(yield t("http://localhost:3000/user/friends",{headers:{authorization:`Bearer ${e}`}})).data,l=a.map(a=>t.get(`http://localhost:3000/chat/last_message/${a.id}`,{headers:{authorization:`Bearer ${e}`}}).then(e=>({id:a.id,lastMessage:e.data.content,lastTime:e.data.time})).catch(e=>({id:a.id,lastMessage:"",lastTime:""}))),n=yield Promise.all(l);a.forEach(e=>{const a=n.find(a=>a.id===e.id);Object.assign(e,{lastMessage:(null==a?void 0:a.lastMessage)||"",lastTime:(null==a?void 0:a.lastTime)||"",isNewmsg:!1})}),w.value=[...a].filter(e=>""!==e.lastMessage)}catch(e){}})),l(()=>{V.on("private-message",({from:a})=>{C.value=a,function(a){e(this,null,function*(){const e=w.value.findIndex(e=>e.id===a);if(-1!==e)try{const l=localStorage.getItem("token"),n=yield t.get(`http://localhost:3000/chat/last_message/${a}`,{headers:{authorization:`Bearer ${l}`}});w.value[e].isNewmsg=!0,w.value[e].lastMessage=n.data.content||"",w.value[e].lastTime=n.data.time||""}catch(l){w.value[e].isNewmsg=!0}})}(a)})}),d(()=>{V.off("private-message")}),(e,a)=>{const l=i("font-awesome-icon");return c(),n("div",F,[b.value?(c(),n("div",H,[s("div",{class:"set_",onClick:S},"Beige"),s("div",{class:"set_",onClick:A},"Mist"),s("div",{class:"set_",onClick:U},"Apricot")])):v("",!0),s("div",O,[s("div",P,[s("input",{type:"button",value:"◁",onClick:j,id:"button"}),a[2]||(a[2]=s("span",null,"Chat",-1)),s("div",R,[s("button",{onClick:a[0]||(a[0]=a=>e.$router.push("/chatbox/chathall"))},"+")])])]),s("div",W,[s("div",{class:"setting",onClick:x},[o(l,{icon:["fas","gear"],title:"更换背景色"})]),s("div",K,[s("div",G,[s("img",{src:L.value,alt:""},null,8,J)])]),s("div",Q,m(I.value?I.value:"游客"),1),s("div",{class:p(["status","occupied"===k.value?"busy":""])},[s("div",X,[h(s("select",{name:"status",id:"statusbox","onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e)},[...a[3]||(a[3]=[s("option",{value:"available",class:"aval"},"available",-1),s("option",{value:"occupied",class:"occu"},"occupied",-1)])],512),[[f,k.value]])])],2),a[4]||(a[4]=s("div",{class:"search"},[s("input",{type:"text",name:"",id:"",placeholder:"Search"})],-1))]),s("div",Y,[a[5]||(a[5]=s("div",{class:"head"},"Last chats",-1)),s("ul",Z,[(c(!0),n(g,null,y(w.value,e=>(c(),n("li",{class:"chat-item",onClick:a=>function(e){T.switchChatUser(e.id),E("todetail",{uname:e.name,img:e.img}),e&&(e.isNewmsg=!1)}(e)},[s("div",ae,[s("div",le,[s("div",{class:p({tips:e.isNewmsg})},null,2),s("img",{src:e.avatar,alt:"图片"},null,8,te)])]),s("div",ne,[s("div",se,m(e.name),1),s("div",oe,m(e.lastMessage),1)]),s("div",ie,m(B(e.lastTime)),1)],8,ee))),256))])])])}}},[["__scopeId","data-v-88ae9297"]]),ue={class:"contacts"},re={class:"bottom"},de={key:0,class:"search"},ve={class:"chat-list"},me=["onClick"],pe={class:"avatar-box"},he={class:"avatar-small"},fe=["src"],ge={class:"detail"},ye={class:"name"},ke=B({__name:"Contacts",emits:["hidecontacts","changecolor","todetail"],setup(o,{emit:i}){const u=a([]),r=a(""),d=a(!1),f=N(),b=i;function w(){b("hidecontacts","关掉聊天")}function C(){d.value=!0}function _(){return e(this,null,function*(){const e=localStorage.getItem("token");if(!r.value)return r.value="",alert("请输入合法的用户名");{const a=r.value;r.value="";const l=yield t.post("http://localhost:3000/user/add",{content:a},{headers:{authorization:`Bearer ${e}`}});alert(l.data.message),location.reload()}})}return l(()=>e(null,null,function*(){try{const e=localStorage.getItem("token"),a=(yield t("http://localhost:3000/user/friends",{headers:{authorization:`Bearer ${e}`}})).data,l=a.map(a=>t.get(`http://localhost:3000/chat/last_message/${a.id}`,{headers:{authorization:`Bearer ${e}`}}).then(e=>({id:a.id,lastMessage:e.data.content,lastTime:e.data.time})).catch(e=>({id:a.id,lastMessage:"",lastTime:""}))),n=yield Promise.all(l);a.forEach(e=>{const a=n.find(a=>a.id===e.id);Object.assign(e,{lastMessage:(null==a?void 0:a.lastMessage)||"",lastTime:(null==a?void 0:a.lastTime)||"",isNewmsg:!1})}),u.value=[...a]}catch(e){}})),(e,a)=>(c(),n("div",ue,[s("div",{class:"top"},[s("div",{class:"top_child"},[s("input",{type:"button",value:"◁",onClick:w,id:"button"}),a[1]||(a[1]=s("span",null,"Contacts",-1)),s("div",{class:"friend_request"},[s("button",{onClick:C},"+")])])]),s("div",re,[d.value?(c(),n("div",de,[h(s("input",{type:"text",name:"",id:"",placeholder:"Search","onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),autocomplete:"off"},null,512),[[k,r.value]]),s("input",{type:"button",value:"添加♂好友",onClick:_})])):v("",!0),s("ul",ve,[(c(!0),n(g,null,y(u.value,e=>(c(),n("li",{class:"chat-item",onClick:a=>function(e){f.switchChatUser(e.id),b("todetail",{uname:e.name,img:e.img})}(e)},[s("div",pe,[s("div",he,[s("div",{class:p({tips:e.isNewmsg})},null,2),s("img",{src:e.avatar,alt:"图片"},null,8,fe)])]),s("div",ge,[s("div",ye,m(e.name),1)])],8,me))),256))])])]))}},[["__scopeId","data-v-ca011280"]]),be={key:0,class:"section2 mobile"},we={class:"section1"},Ce={key:0,class:"section2"},_e={key:1,class:"section2"},Ie=B({__name:"ChatView",setup(e){const t=a("beige"),u=a(null),r=C(),d=a(!0),m=a(!1),p=a(!1),h=a(!1);function f(e){d.value=!1}function g(e){d.value=!0,m.value=!1}function y(e){d.value=!1,m.value=!0}function k(e){m.value=!1}function _(e){t.value=e.color,u.value.setAttribute("data-theme",t.value)}function I(e){p.value=!0;const a=e.uname,l=e.img;r.push({path:"/chatdetail",query:{uname:a,img:l}})}function L(){p.value=!0,r.push({path:"/chat-ai"})}function T(){p.value&&(p.value=!1)}function E(){h.value=window.innerWidth<=768}return l(()=>{E(),window.addEventListener("resize",E),b(()=>{u.value.setAttribute("data-theme",t.value)})}),(e,a)=>{const l=i("router-view");return h.value?(c(),n("div",{key:0,class:"container mobile",ref_key:"container",ref:u},[p.value?v("",!0):(c(),n("div",be,[o(ce,{onHidechat:f,onChangecolor:_,onTodetail:I})])),p.value?(c(),w(l,{key:1,class:"section3",onClosemessage:T})):v("",!0)],512)):(c(),n("div",{key:1,class:"container",ref_key:"container",ref:u},[s("div",we,[o(D,{onShowchat:g,onShowcontacts:y,onTodetail:L})]),d.value?(c(),n("div",Ce,[o(ce,{onHidechat:f,onChangecolor:_,onTodetail:I})])):v("",!0),m.value?(c(),n("div",_e,[o(ke,{onHidecontacts:k,onTodetail:I})])):v("",!0),p.value?(c(),w(l,{key:2,class:"section3",onClosemessage:T})):v("",!0)],512))}}},[["__scopeId","data-v-b1ba47e8"]]),Le={__name:"App",setup:e=>(e,a)=>{const l=i("router-view");return c(),w(l)}},Te={},Ee={class:"login-page"},je=B({__name:"Login",setup(o){const i=j(()=>function(e,a){let l=Promise.resolve();if(a&&a.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),n=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));l=e(a.map(e=>{if((e=function(e){return"/"+e}(e))in Te)return;Te[e]=!0;const a=e.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${l}`))return;const t=document.createElement("link");return t.rel=a?"stylesheet":"modulepreload",a||(t.as="script"),t.crossOrigin="",t.href=e,n&&t.setAttribute("nonce",n),document.head.appendChild(t),a?new Promise((a,l)=>{t.addEventListener("load",a),t.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function t(e){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=e,window.dispatchEvent(a),!a.defaultPrevented)throw e}return l.then(a=>{for(const e of a||[])"rejected"===e.status&&t(e.reason);return e().catch(t)})}(()=>Promise.resolve().then(()=>za),void 0)),u=a(null),r=a(!1);let d=null;const m=()=>{r.value||(r.value=!0)};l(()=>{d="requestIdleCallback"in window?requestIdleCallback(()=>m(),{timeout:1200}):setTimeout(m,800);const e=()=>{m(),window.removeEventListener("scroll",e),window.removeEventListener("mousemove",e),window.removeEventListener("touchstart",e),window.removeEventListener("keydown",e)};window.addEventListener("scroll",e,{once:!0,passive:!0}),window.addEventListener("mousemove",e,{once:!0}),window.addEventListener("touchstart",e,{once:!0,passive:!0}),window.addEventListener("keydown",e,{once:!0})}),_(()=>{d&&("cancelIdleCallback"in window?cancelIdleCallback(d):clearTimeout(d))});const f=C(),g=(e,a)=>{let l,t=0;return function(...n){const s=Date.now();s-t>a?(e.apply(this,n),t=s):(clearTimeout(l),l=setTimeout(()=>{e.apply(this,n),t=Date.now()},a-(s-t)))}},y=g(()=>{u.value&&u.value.onLoginBoxEnter()},100),b=g(()=>{u.value&&u.value.onLoginBoxLeave()},100),x=a(""),S=a(""),A=()=>e(null,null,function*(){if(x.value&&S.value)try{const e=yield t.post("http://localhost:3000/user/login",{username:x.value,password:S.value});localStorage.setItem("token",e.data.token),f.push("/")}catch(e){alert("登录失败，请稍后再试")}else alert("请输入用户名和密码")}),U=a(""),B=a(""),$=a(""),M=a(!1),q=()=>{M.value=!M.value},z=()=>e(null,null,function*(){if(U.value&&B.value&&$.value)if(B.value===$.value)try{const e=(yield t.post("http://localhost:3000/user/register",{username:U.value,password:B.value})).data.message;alert(e),q()}catch(e){e.response&&409===e.response.status?alert(e.response.data.message):alert("注册失败，请稍后再试")}else alert("两次密码不一致");else alert("请填写完整信息")});return(e,a)=>(c(),n("div",Ee,[r.value?(c(),w(L,{key:0},{default:I(()=>[(c(),w(E(T(i)),{ref_key:"videoBackground",ref:u},null,512))]),fallback:I(()=>[...a[9]||(a[9]=[s("div",{class:"video-container"},[s("div",{class:"loading-placeholder"},[s("div",{class:"loading-spinner"}),s("p",null,"加载中...")])],-1)])]),_:1})):v("",!0),s("div",{class:p(["flip-wrapper",{flipped:M.value}])},[s("div",{class:"login-box front",onMouseenter:a[2]||(a[2]=(...e)=>T(y)&&T(y)(...e)),onMouseleave:a[3]||(a[3]=(...e)=>T(b)&&T(b)(...e))},[a[10]||(a[10]=s("h1",{style:{"text-align":"center"}},"COFFEE CHAT BAR",-1)),a[11]||(a[11]=s("h2",null,"登录",-1)),a[12]||(a[12]=s("label",{for:"login-username"},"用户名",-1)),h(s("input",{id:"login-username","onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),type:"text",placeholder:"请输入用户名",autocomplete:"off"},null,512),[[k,x.value]]),a[13]||(a[13]=s("label",{for:"login-password"},"密码",-1)),h(s("input",{id:"login-password","onUpdate:modelValue":a[1]||(a[1]=e=>S.value=e),type:"password",placeholder:"请输入密码",autocomplete:"off"},null,512),[[k,S.value]]),s("button",{onClick:A},"登录"),s("div",{class:"flip-link",onClick:q},"还没有账号？点击注册")],32),s("div",{class:"login-box back",onMouseenter:a[7]||(a[7]=(...e)=>T(y)&&T(y)(...e)),onMouseleave:a[8]||(a[8]=(...e)=>T(b)&&T(b)(...e))},[a[14]||(a[14]=s("h1",{style:{"text-align":"center"}},"COFFEE CHAT BAR",-1)),a[15]||(a[15]=s("h2",null,"注册",-1)),a[16]||(a[16]=s("label",{for:"register-username"},"用户名",-1)),h(s("input",{id:"register-username","onUpdate:modelValue":a[4]||(a[4]=e=>U.value=e),type:"text",placeholder:"请输入用户名",autocomplete:"off"},null,512),[[k,U.value]]),a[17]||(a[17]=s("label",{for:"register-password"},"密码",-1)),h(s("input",{id:"register-password","onUpdate:modelValue":a[5]||(a[5]=e=>B.value=e),type:"password",placeholder:"请输入密码",autocomplete:"off"},null,512),[[k,B.value]]),a[18]||(a[18]=s("label",{for:"register-confirm"},"确认密码",-1)),h(s("input",{id:"register-confirm","onUpdate:modelValue":a[6]||(a[6]=e=>$.value=e),type:"password",placeholder:"请再次输入密码",autocomplete:"off"},null,512),[[k,$.value]]),s("button",{onClick:z},"注册"),s("div",{class:"flip-link",onClick:q},"已有账号？返回登录")],32)],2)]))}},[["__scopeId","data-v-b3607e10"]]);const xe=B({},[["render",function(e,a){const l=i("router-view");return c(),w(l)}]]),Se={class:"container"},Ae={key:0,class:"overlay"},Ue={class:"menu"},Be={class:"build-name"},$e={class:"build-id"},Me={key:1,class:"overlay"},qe={class:"menu"},ze={class:"notice"},De={style:{color:"red","font-weight":"1000"}},Ne={class:"middle"},Ve={class:"room-list"},Fe=["onClick"],He={class:"room-name"},Oe={class:"room-id"},Pe=B({__name:"ChatHall",setup(o){const i=C(),u=a(""),r=a(""),d=a(!1),p=a([]),f=a(""),b=a(!1),w=a(""),_=a("");function I(){d.value||(d.value=!0)}function L(){return e(this,null,function*(){if(u.value&&r.value){const a=localStorage.getItem("token");try{yield t.post(`http://localhost:3000/room/create/${r.value}`,{roomname:u.value},{headers:{authorization:`Bearer ${a}`}});d.value=!1,i.push({path:"chatroom",query:{id:r.value,name:u.value,uname:f.value}}),u.value="",r.value=""}catch(e){alert("房间号重复，创建失败，请重试!"),u.value="",r.value=""}}})}function T(){return e(this,null,function*(){i.push({path:"chatroom",query:{id:_.value,name:w.value,uname:f.value}}),b.value=!1})}function E(){d.value&&(d.value=!1),b.value&&(b.value=!1)}function j(){i.back()}return a(""),l(()=>e(null,null,function*(){try{const e=localStorage.getItem("token"),a=yield t.get("http://localhost:3000/room/getrooms",{headers:{authorization:`Bearer ${e}`}});p.value=a.data.roomlists,f.value=a.data.uname}catch(e){}})),(e,a)=>(c(),n("div",Se,[s("div",{class:"return",onClick:j},"←"),d.value?(c(),n("div",Ae,[s("div",Ue,[s("div",{class:"close",onClick:E},"×"),s("div",Be,[h(s("input",{type:"text",name:"room-name",id:"room-name","onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),autocomplete:"off",placeholder:"房间名",maxlength:"6"},null,512),[[k,u.value]])]),s("div",$e,[h(s("input",{type:"text",name:"room-name",id:"room-name","onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),autocomplete:"off",placeholder:"房间号",maxlength:"6",onInput:a[2]||(a[2]=e=>r.value=r.value.replace(/\D/g,""))},null,544),[[k,r.value]])]),s("button",{onClick:L},"创建房间~")])])):v("",!0),b.value?(c(),n("div",Me,[s("div",qe,[s("div",{class:"close",onClick:E},"×"),s("div",ze,[a[3]||(a[3]=x("即将进入房间：",-1)),s("strong",De,m(w.value),1)]),s("button",{onClick:T},"开启畅聊~")])])):v("",!0),a[5]||(a[5]=s("div",{class:"top"},"匿名聊天室",-1)),s("div",Ne,[s("div",Ve,[(c(!0),n(g,null,y(p.value,e=>(c(),n("div",{class:"room-item",onClick:a=>function(e){w.value=e.RoomName,_.value=e.RoomID,b.value=!0}(e)},[s("div",He,m(e.RoomName),1),s("div",Oe,[s("strong",null,m(e.RoomID),1)]),a[4]||(a[4]=s("div",{class:"room-num"},"在线人数:999+",-1))],8,Fe))),256))])]),s("div",{class:"bottom"},[s("button",{onClick:I},"创建聊天室")])]))}},[["__scopeId","data-v-5b00d342"]]),Re={class:"container"},We={class:"top"},Ke={class:"left"},Ge={class:"roomname"},Je={class:"roomnum"},Qe={class:"middle"},Xe={class:"users"},Ye={class:"host"},Ze={class:"avatar-name"},ea={class:"audiences"},aa={class:"seat"},la={class:"seat-logo"},ta={class:"seat-number"},na={class:"chats"},sa={class:"notice"},oa={class:"notice-content"},ia={class:"board"},ca={key:0,class:"emoji-picker-container relative"},ua={class:"input-area"},ra=B({__name:"ChatRoom",setup(e){const t=S(),o=C(),i=a(t.query.name),u=a(t.query.id),r=a(0),p=a(t.query.uname),f=a(""),w=a([]),_=a(null),I=a(!1),L=a(Array.from({length:8},()=>({username:null,useravatar:"🪑"})));let T=null,E=null;function j(e){f.value+=e.detail.emoji.unicode,I.value=!1}function B(){o.back()}function $(){f.value.trim()&&(V.emit("group-message",f.value,p.value),f.value="")}function M(){I.value=!I.value}function q(){V.off("connect"),V.off("group-message"),V.off("update"),V.off("notice"),V.off("Full"),T&&E&&(T.removeEventListener("emoji-click",E),T=null,E=null)}return A(I,e=>{e?b(()=>{T=document.getElementById("emoji-picker-instance"),T&&(E=j,T.addEventListener("emoji-click",E))}):T&&E&&(T.removeEventListener("emoji-click",E),T=null,E=null)}),l(()=>{q(),V.connected?V.emit("joinroom",{room:u.value,username:p.value}):V.on("connect",()=>{V.emit("joinroom",{room:u.value,username:p.value})}),V.on("group-message",({msg:e,uname:a})=>{w.value.push({role:a,content:e}),b(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)})}),V.on("update",e=>{L.value=e,r.value=e.filter(e=>null!==e.username).length}),V.on("notice",e=>{w.value.push({role:"系统通知",content:e}),b(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)})}),V.on("Full",()=>{o.back()})}),d(()=>{q()}),(e,a)=>(c(),n("div",Re,[s("div",We,[s("div",Ke,[s("div",Ge,m(i.value),1),s("div",Je,[a[1]||(a[1]=x("房间号：",-1)),s("strong",null,m(u.value),1)])]),s("div",{class:"right"},[a[2]||(a[2]=s("div",{class:"counts"},[x("999+"),s("strong",null,"Online")],-1)),s("div",{class:"return",onClick:B},"✖")])]),s("div",Qe,[s("div",Xe,[s("div",Ye,[a[3]||(a[3]=s("div",{class:"avatar"},[s("img",{src:"https://reus.oss-cn-shenzhen.aliyuncs.com/images/ava.jpg",alt:"图片"})],-1)),s("div",Ze,m(p.value),1)]),s("div",ea,[(c(!0),n(g,null,y(L.value,(e,a)=>(c(),n("div",{class:"audience",key:a},[s("div",aa,[s("div",la,m(e.useravatar),1),s("div",ta,m(e.username?e.username:`${a+1}号位`),1)])]))),128))])]),s("div",na,[s("div",sa,[s("div",oa,[a[4]||(a[4]=x(" 欢迎来到 ",-1)),s("span",null,m(i.value),1),a[5]||(a[5]=x(" 聊天室，请遵循社区基本规则，不要以身试险，祝您愉快! ",-1))])]),s("div",ia,[s("div",{class:"board-content",ref_key:"log",ref:_},[s("ul",null,[(c(!0),n(g,null,y(w.value,(e,a)=>(c(),n("li",{key:a},m(e.role?e.role:"游客")+"："+m(e.content),1))),128))])],512)])])]),I.value?(c(),n("div",ca,[...a[6]||(a[6]=[s("emoji-picker",{id:"emoji-picker-instance",class:"absolute bottom-full right-0 mb-2"},null,-1)])])):v("",!0),s("div",ua,[h(s("input",{type:"text",id:"chat-input","onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onKeydown:U($,["enter"]),autocomplete:"off"},null,544),[[k,f.value]]),s("input",{type:"button",value:"😊",id:"emoji-btn",class:"send-button",onClick:M}),s("input",{type:"button",value:"发送",class:"send-button",id:"send-button",onClick:$})])]))}},[["__scopeId","data-v-41e3cf31"]]),da={class:"box"},va={class:"main"},ma={class:"top"},pa={key:0,class:"avatar"},ha=["src"],fa={class:"content"},ga={key:0,class:"file-message"},ya=["href"],ka=["src","alt"],ba=["href"],wa={class:"bottom"},Ca={key:0,class:"emoji-picker-container"},_a={class:"send"},Ia=B({__name:"Content",emits:["closemessage"],setup(o,{emit:i}){const u=a([]),r=a(null),f=a(""),w=a(!0),C=N(),_=a(""),I=a(""),L=S(),E=a(!1),j=a(null),B=a(null);function $(){return e(this,null,function*(){const e=yield t.get(`http://localhost:3000/user/friend_avatar/${C.currentChatUser}`);I.value=e.data.ava})}function M(){return e(this,null,function*(){try{const e=localStorage.getItem("token"),a=yield t.get(`http://localhost:3000/chat/messages/${C.currentChatUser}`,{headers:{Authorization:`Bearer ${e}`}});u.value=a.data}catch(e){}})}function q(){j.value.click()}function z(a){return e(this,null,function*(){if(a.preventDefault(),f.value.trim())try{const e=localStorage.getItem("token");yield t.post(`http://localhost:3000/chat/messages/${C.currentChatUser}`,{content:f.value},{headers:{Authorization:`Bearer ${e}`}});f.value="",yield M(),V.emit("private-message",{to:C.currentChatUser}),b(()=>{const e=r.value;e&&(e.scrollTop=e.scrollHeight)})}catch(e){}else B.value&&(yield uploadFile())})}function D(){w.value=!w.value}l(()=>{_.value=L.query.uname,I.value=L.query.img,$(),M();const e=r.value;e&&(e.scrollTop=e.scrollHeight)}),A(()=>C.currentChatUser,(a,l)=>e(null,null,function*(){a!==l&&(_.value=L.query.uname,I.value=L.query.img,yield $(),yield M(),b(()=>{const e=r.value;e&&(e.scrollTop=e.scrollHeight)}))})),A(()=>L.query.uname,e=>{_.value=e}),A(u,()=>{b(()=>{const e=r.value;e&&(e.scrollTop=e.scrollHeight)})});const F=i;function H(){F("closemessage")}l(()=>{V.on("private-message",a=>e(null,[a],function*({from:e}){yield M()})),V.on("private-file-message",a=>e(null,[a],function*({from:e,fileUrl:a,fileName:l,fileType:t}){u.value.push({from:e,content:`[文件: ${l}]`,file:{fileUrl:a,fileName:l,fileType:t}}),b(()=>{const e=r.value;e&&(e.scrollTop=e.scrollHeight)})}))}),d(()=>{V.off("private-message"),V.off("private-file-message")});let O=null,P=null;function R(){E.value=!E.value}function W(e){f.value+=e.detail.emoji.unicode,E.value=!1}return A(E,e=>{e?b(()=>{O=document.getElementById("emoji-picker-instance"),O&&(P=W,O.addEventListener("emoji-click",P))}):O&&P&&(O.removeEventListener("emoji-click",P),O=null,P=null)}),(e,a)=>(c(),n("div",da,[s("div",va,[s("div",ma,[s("h4",null,m(_.value),1),s("button",{onClick:D},m(w.value?"🔊":"🔇"),1),s("button",{class:"off",onClick:H},"✖")]),s("div",{class:"middle",ref_key:"messageList",ref:r},[s("ul",null,[(c(!0),n(g,null,y(u.value,(e,a)=>(c(),n("li",{class:"message",key:a},[e.from===T(C).currentChatUser?(c(),n("div",pa,[s("img",{src:I.value,alt:"图片"},null,8,ha)])):v("",!0),s("div",{class:p(["text",{me:e.from!==T(C).currentChatUser}])},[s("div",fa,[e.file?(c(),n("div",ga,[e.file.fileType&&e.file.fileType.startsWith("image/")?(c(),n("a",{key:0,href:e.file.fileUrl,target:"_blank",rel:"noopener noreferrer"},[s("img",{src:e.file.fileUrl,alt:e.file.fileName,class:"chat-image-preview"},null,8,ka)],8,ya)):(c(),n("a",{key:1,href:e.file.fileUrl,target:"_blank",rel:"noopener noreferrer",class:"file-link"}," 📁 "+m(e.file.fileName),9,ba))])):(c(),n(g,{key:1},[x(m(e.content),1)],64))])],2)]))),128))])],512),s("div",wa,[E.value?(c(),n("div",Ca,[...a[2]||(a[2]=[s("emoji-picker",{id:"emoji-picker-instance",class:"absolute bottom-full right-0 mb-2"},null,-1)])])):v("",!0),s("div",_a,[s("button",{onClick:R},"😋"),s("input",{type:"file",ref_key:"fileInputRef",ref:j,recepet:"image/*",style:{display:"none"},onChange:a[0]||(a[0]=(...a)=>e.handleFileChange&&e.handleFileChange(...a))},null,544),s("button",{class:"file-button",onClick:q},"📁"),s("button",{onClick:z,class:p({active:f.value.trim().length>0||B.value})},"send",2)]),h(s("textarea",{name:"content",id:"content","onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),onKeyup:U(z,["enter"])},null,544),[[k,f.value]])])])]))}},[["__scopeId","data-v-25cc26aa"]]),La={class:"box"},Ta={class:"main"},Ea={key:0,class:"avatar"},ja={class:"content"},xa={key:0,class:"message"},Sa={class:"bottom"},Aa={key:0,class:"emoji-picker-container"},Ua={class:"send"},Ba=["disabled"],$a=["disabled"],Ma=B({__name:"Assistant",emits:["closemessage"],setup(o,{emit:i}){const u=a([{from:"AI",content:"你好，欢迎来到CCB！我是你的AI智能小助手，请询问我任何问题~",time:(new Date).toLocaleString()}]),r=a(null),d=a(""),f=a(!1),w=a(!1);function C(a){return e(this,null,function*(){if(a.preventDefault(),w.value)return;const e=d.value.trim();if(e){u.value.push({from:"user",content:e,time:(new Date).toLocaleString()}),d.value="",_(),w.value=!0,_();try{const a=localStorage.getItem("token"),l=(yield t.post("http://localhost:3000/api/deepseek-chat",{question:e},{headers:{Authorization:`Bearer ${a}`}})).data.answer;u.value.push({from:"AI",content:l,time:(new Date).toLocaleString()})}catch(l){u.value.push({from:"AI",content:"抱歉，AI小助手正在打三国杀，没空回答你的问题，请稍后再试。",time:(new Date).toLocaleString()})}finally{w.value=!1,_()}}})}function _(){b(()=>{const e=r.value;e&&(e.scrollTop=e.scrollHeight)})}l(()=>{_()});const I=i;function L(){I("closemessage")}let T=null,E=null;function j(e){d.value+=e.detail.emoji.unicode,f.value=!1}return A(f,e=>{e?b(()=>{T=document.getElementById("emoji-picker-instance"),T&&(E=j,T.addEventListener("emoji-click",E))}):T&&E&&(T.removeEventListener("emoji-click",E),T=null,E=null)}),(e,a)=>(c(),n("div",La,[s("div",Ta,[s("div",{class:"top"},[a[1]||(a[1]=s("h3",null,"AI智能小助手",-1)),s("button",{class:"off",onClick:L},"✖")]),s("div",{class:"middle",ref_key:"messageList",ref:r},[s("ul",null,[(c(!0),n(g,null,y(u.value,(e,l)=>(c(),n("li",{class:"message",key:l},["AI"===e.from?(c(),n("div",Ea,[...a[2]||(a[2]=[s("img",{src:"https://reus.oss-cn-shenzhen.aliyuncs.com/images/ds.jpg",alt:"AI头像"},null,-1)])])):v("",!0),s("div",{class:p(["text",{me:"user"===e.from}])},[s("div",ja,m(e.content),1)],2)]))),128)),w.value?(c(),n("li",xa,[...a[3]||(a[3]=[s("div",{class:"avatar"},[s("img",{src:"https://reus.oss-cn-shenzhen.aliyuncs.com/images/ds.jpg",alt:"AI头像"})],-1),s("div",{class:"text"},[s("div",{class:"content loading-dots"},[s("span",null,"."),s("span",null,"."),s("span",null,".")])],-1)])])):v("",!0)])],512),s("div",Sa,[f.value?(c(),n("div",Aa,[...a[4]||(a[4]=[s("emoji-picker",{id:"emoji-picker-instance",class:"absolute bottom-full right-0 mb-2"},null,-1)])])):v("",!0),s("div",Ua,[s("button",{onClick:C,class:p({active:d.value.trim().length>0}),disabled:w.value},"Ask deepseek your questions!",10,Ba)]),h(s("textarea",{name:"content",id:"content","onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),onKeyup:U(C,["enter"]),disabled:w.value},null,40,$a),[[k,d.value]])])])]))}},[["__scopeId","data-v-6f2b89de"]]),qa=B({__name:"VideoBackground",setup(t,{expose:o}){const i=a(null),u=a(null);let r=null,d=null,v=!1;const m=a(!1),p=a(!1),h=(e,a)=>{let l,t=0;return function(...n){const s=Date.now();s-t>a?(e.apply(this,n),t=s):(clearTimeout(l),l=setTimeout(()=>{e.apply(this,n),t=Date.now()},a-(s-t)))}},f=()=>{i.value&&r&&v&&(r.drawImage(i.value,0,0,u.value.width,u.value.height),d=requestAnimationFrame(f))},g=()=>e(null,null,function*(){i.value&&v&&(yield i.value.play(),f())}),y=()=>{i.value&&!i.value.paused&&i.value.pause(),d&&(cancelAnimationFrame(d),d=null)},k=()=>{v=!0,m.value&&!p.value&&g()},b=h(()=>{m.value=!0,!p.value&&v&&g()},100),w=h(()=>{m.value=!1,y()},100);return o({onLoginBoxEnter:h(()=>{p.value=!0,y()},100),onLoginBoxLeave:h(()=>{p.value=!1,m.value&&v&&g()},100)}),l(()=>{r=u.value.getContext("2d")}),_(()=>{y()}),(e,a)=>(c(),n("div",{ref:"container",class:"video-container",onMouseenter:a[0]||(a[0]=(...e)=>T(b)&&T(b)(...e)),onMouseleave:a[1]||(a[1]=(...e)=>T(w)&&T(w)(...e))},[s("canvas",{ref_key:"canvas",ref:u,width:"1280",height:"720"},null,512),s("video",{ref_key:"video",ref:i,src:"https://reus.oss-cn-shenzhen.aliyuncs.com/videos/Walking_girl.mp4",muted:"",loop:"",playsinline:"",style:{display:"none"},onCanplay:k},null,544)],544))}},[["__scopeId","data-v-20901aae"]]),za=Object.freeze(Object.defineProperty({__proto__:null,default:qa},Symbol.toStringTag,{value:"Module"})),Da=B({__name:"File",setup:e=>(a(null),a(""),a([]),(e,a)=>(c(),w(qa)))},[["__scopeId","data-v-eca8e9cd"]]);export{Ma as A,Ia as C,Da as F,je as L,Le as _,Ie as a,Pe as b,ra as c,xe as d};
